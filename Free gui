local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- =========================
-- CHECK RAYFIELD
-- =========================
if not Rayfield then
    warn("Failed to load Rayfield library")
    return
end

-- =========================
-- WINDOW
-- =========================
local Window = Rayfield:CreateWindow({
    Name = "Vision Hub",
    LoadingTitle = "Vision Script",
    LoadingSubtitle = "by Vision",
    ConfigurationSaving = {
       Enabled = false,
       FileName = "Vision Script Hub"
    },
    Discord = {
       Enabled = true,
       Invite = "GYH92be25Z",
       RememberJoins = true
    },
    KeySystem = true,
    KeySettings = {
       Title = "Vision Script Hub| Key",
       Subtitle = "Link In Discord Server",
       Note = "Join Server From Misc Tab",
       FileName = "BladeBallKey",
       SaveKey = false,
       GrabKeyFromSite = true,
       Key = {"https://pastebin.com/raw/QZYyHa0H"}
    }
})

if not Window then
    warn("Failed to create window. Please check the Rayfield library or script parameters.")
    return
end

-- =========================
-- THROWING TAB
-- =========================
local ThrowingTab = Window:CreateTab("Throwing", nil)
local QBAimbotSection = ThrowingTab:CreateSection("QB Aimbot")

-- QB AIMBOT TOGGLE
local qbToggle = ThrowingTab:CreateToggle({
    Name = "QB Aimbot",
    CurrentValue = false,
    Flag = "QB_Toggle",
    Callback = function(Value)
        if Value then
            spawn(function()
                --====================
                -- QB AIM SYSTEM SCRIPT
                --====================

                --[[ 
                    QB AIM SYSTEM (FIXED FULL)
                    Bullet = side lead | MAG/DIME correct | Mobile support | Draggable GUI
                --]]

                local Players = game:GetService("Players")
                local RunService = game:GetService("RunService")
                local UIS = game:GetService("UserInputService")
                local Camera = workspace.CurrentCamera
                local LocalPlayer = Players.LocalPlayer

                local GRAVITY = Vector3.new(0,-28,0)
                local MAX_POWER = 95

                local MAG_STATIC_LEAD = 12
                local MAG_MOVING_LEAD = 40
                local DIME_STATIC_LEAD = 12
                local DIME_MOVING_LEAD = 46

                local currentPass = "Bullet"
                local locked = false
                local lockedTarget = nil
                local customAngle = 62

                -- GUI
                local gui = Instance.new("ScreenGui")
                gui.Name = "QB_AIM_GUI"
                gui.ResetOnSpawn = false
                gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

                local frame = Instance.new("Frame", gui)
                frame.Size = UDim2.new(0,330,0,190)
                frame.Position = UDim2.new(0.02,0,0.4,0)
                frame.BackgroundColor3 = Color3.fromRGB(0,0,0)
                frame.BorderSizePixel = 2
                frame.BorderColor3 = Color3.fromRGB(0,120,255)
                Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)

                -- DRAG FRAME
                local dragging, dragStart, startPos
                frame.InputBegan:Connect(function(i)
                    if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
                        dragging = true
                        dragStart = i.Position
                        startPos = frame.Position
                    end
                end)
                frame.InputChanged:Connect(function(i)
                    if dragging then
                        local d = i.Position - dragStart
                        frame.Position = UDim2.new(startPos.X.Scale,startPos.X.Offset+d.X,startPos.Y.Scale,startPos.Y.Offset+d.Y)
                    end
                end)
                frame.InputEnded:Connect(function() dragging = false end)

                -- LABELS
                local function label(txt,y)
                    local l = Instance.new("TextLabel", frame)
                    l.Size = UDim2.new(1,-20,0,20)
                    l.Position = UDim2.new(0,10,0,y)
                    l.BackgroundTransparency = 1
                    l.TextColor3 = Color3.new(1,1,1)
                    l.Font = Enum.Font.GothamBold
                    l.TextSize = 14
                    l.TextXAlignment = Enum.TextXAlignment.Left
                    l.Text = txt
                    return l
                end

                local passLabel = label("Pass: Bullet",10)
                local targetLabel = label("Target: None",35)
                local powerLabel = label("Power: 0",60)

                -- CHANGE PASS BUTTON
                local passBtn = Instance.new("TextButton", frame)
                passBtn.Size = UDim2.new(0,150,0,32)
                passBtn.Position = UDim2.new(0,10,0,90)
                passBtn.Text = "CHANGE PASS"
                passBtn.Font = Enum.Font.GothamBold
                passBtn.TextSize = 15
                passBtn.TextColor3 = Color3.new(1,1,1)
                passBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
                passBtn.BorderSizePixel = 2
                passBtn.BorderColor3 = Color3.fromRGB(0,120,255)
                Instance.new("UICorner", passBtn).CornerRadius = UDim.new(0,10)
                passBtn.MouseButton1Click:Connect(function()
                    currentPass = currentPass=="Bullet" and "Mag" or currentPass=="Mag" and "Dime" or "Bullet"
                end)

                -- LOCK PLAYER BUTTON
                local lockBtn = Instance.new("TextButton", frame)
                lockBtn.Size = UDim2.new(0,150,0,32)
                lockBtn.Position = UDim2.new(0,170,0,90)
                lockBtn.Text = "LOCK: OFF"
                lockBtn.Font = Enum.Font.GothamBold
                lockBtn.TextSize = 15
                lockBtn.TextColor3 = Color3.new(1,1,1)
                lockBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
                lockBtn.BorderSizePixel = 2
                lockBtn.BorderColor3 = Color3.fromRGB(0,120,255)
                Instance.new("UICorner", lockBtn).CornerRadius = UDim.new(0,10)
                lockBtn.MouseButton1Click:Connect(function()
                    locked = not locked
                    lockedTarget = locked and getClosestTarget() or nil
                    lockBtn.Text = locked and "LOCK: ON" or "LOCK: OFF"
                end)

                -- THROW BUTTON
                local throwBtn = Instance.new("TextButton", gui)
                throwBtn.Size = UDim2.new(0,150,0,60)
                throwBtn.Position = UDim2.new(0.75,0,0.75,0)
                throwBtn.Text = "THROW"
                throwBtn.Font = Enum.Font.GothamBold
                throwBtn.TextSize = 20
                throwBtn.TextColor3 = Color3.new(1,1,1)
                throwBtn.BackgroundColor3 = Color3.fromRGB(0,0,0)
                throwBtn.BorderSizePixel = 2
                throwBtn.BorderColor3 = Color3.fromRGB(0,120,255)
                Instance.new("UICorner", throwBtn).CornerRadius = UDim.new(0,16)

                local held, holdStart, draggingBtn
                local btnStart, btnPos
                throwBtn.InputBegan:Connect(function(i)
                    if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
                        held = true
                        holdStart = tick()
                        btnStart = i.Position
                        btnPos = throwBtn.Position
                    end
                end)
                throwBtn.InputChanged:Connect(function(i)
                    if held and tick()-holdStart > 0.2 then
                        draggingBtn = true
                        local d = i.Position - btnStart
                        throwBtn.Position = UDim2.new(btnPos.X.Scale,btnPos.X.Offset+d.X,btnPos.Y.Scale,btnPos.Y.Offset+d.Y)
                    end
                end)
                throwBtn.InputEnded:Connect(function()
                    if not draggingBtn then throwBall() end
                    held = false
                    draggingBtn = false
                end)

                -- TARGETING
                function getClosestTarget()
                    local mouse = UIS:GetMouseLocation()
                    local best,bestDist = nil,math.huge
                    for _,p in pairs(Players:GetPlayers()) do
                        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                            local pos,onScreen = Camera:WorldToViewportPoint(p.Character.HumanoidRootPart.Position)
                            if onScreen then
                                local d = (Vector2.new(pos.X,pos.Y)-mouse).Magnitude
                                if d < bestDist then
                                    bestDist = d
                                    best = p.Character
                                end
                            end
                        end
                    end
                    return best
                end

                -- PREDICTION
                function getPredictedPosition(hrp)
                    local vel = Vector3.new(hrp.Velocity.X,0,hrp.Velocity.Z)
                    local speed = vel.Magnitude
                    local dir = speed>1 and vel.Unit or Vector3.zero
                    local perp = Vector3.new(-dir.Z,0,dir.X)

                    if currentPass=="Bullet" then
                        local sideLead = math.clamp(speed*0.55,8,14)
                        if vel.X<0 then perp = -perp end
                        return hrp.Position + perp*sideLead + Vector3.new(0,1.5,0)
                    end

                    if currentPass=="Mag" then
                        local lead = speed>1 and MAG_MOVING_LEAD or MAG_STATIC_LEAD
                        return hrp.Position + dir*lead + Vector3.new(0,6,0)
                    end

                    local lead = speed>1 and DIME_MOVING_LEAD or DIME_STATIC_LEAD
                    return hrp.Position + dir*lead + Vector3.new(0,12,0)
                end

                -- BALLISTICS
                function calculateVelocity(startPos,targetPos,angleDeg)
                    local dxz = Vector3.new(targetPos.X-startPos.X,0,targetPos.Z-startPos.Z).Magnitude
                    local dy = targetPos.Y-startPos.Y
                    local rad = math.rad(angleDeg)
                    local cos,sin = math.cos(rad),math.sin(rad)
                    local denom = 2*cos^2*(dxz*math.tan(rad)-dy)
                    if denom<=0 then return end
                    local speed = math.sqrt(GRAVITY.Magnitude*dxz^2/denom)
                    local dir = (Vector3.new(targetPos.X,startPos.Y,targetPos.Z)-startPos).Unit
                    return dir*(speed*cos)+Vector3.new(0,speed*sin,0),speed
                end

                -- THROW FUNCTION
                function throwBall()
                    local char = LocalPlayer.Character
                    local head = char and char:FindFirstChild("Head")
                    local football = char and char:FindFirstChild("Football")
                    local handle = football and football:FindFirstChild("Handle")
                    if not (head and handle) then return end

                    local target = locked and lockedTarget or getClosestTarget()
                    if not target then return end
                    local hrp = target:FindFirstChild("HumanoidRootPart")
                    if not hrp then return end

                    local predicted = getPredictedPosition(hrp)
                    local velocity,power = calculateVelocity(head.Position,predicted,customAngle)
                    if not velocity then return end

                    power = currentPass=="Bullet" and 95 or math.clamp(math.floor(power),1,MAX_POWER)

                    local t = 1.5
                    local endPos = head.Position + velocity*t + 0.5*GRAVITY*t*t

                    handle.RemoteEvent:FireServer("Clicked",head.Position,endPos,power)
                end

                -- LOOP
                RunService.RenderStepped:Connect(function()
                    passLabel.Text = "Pass: "..currentPass
                    local target = locked and lockedTarget or getClosestTarget()
                    if target then
                        targetLabel.Text = "Target: "..target.Name
                    else
                        targetLabel.Text = "Target: None"
                    end
                end)

                -- INPUT (Screen Click instead of E)
                UIS.InputBegan:Connect(function(i,gp)
                    if gp then return end
                    if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
                        throwBall()
                    end
                end)
            end)
        end
    end
})
